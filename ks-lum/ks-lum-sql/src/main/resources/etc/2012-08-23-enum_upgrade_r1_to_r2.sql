-- Script to upgrade r1 Enumeration tables to r2 enumeration tables.

ALTER TABLE KSEM_CTX_T ADD (CREATEID VARCHAR2(255) NULL,UPDATEID VARCHAR2(255) NULL, CREATETIME TIMESTAMP(6) NULL,  UPDATETIME TIMESTAMP(6) NULL)
/
ALTER TABLE KSEM_ENUM_T ADD (CREATEID VARCHAR2(255) NULL, UPDATEID VARCHAR2(255) NULL, CREATETIME TIMESTAMP(6) NULL, UPDATETIME TIMESTAMP(6) NULL)
/
ALTER TABLE KSEM_ENUM_VAL_T ADD (CREATEID VARCHAR2(255) NULL, UPDATEID VARCHAR2(255) NULL, CREATETIME TIMESTAMP(6) NULL, UPDATETIME TIMESTAMP(6) NULL)
/
ALTER TABLE KSEM_ENUM_T RENAME COLUMN DESCR TO DESCR_PLAIN
/
ALTER TABLE KSEM_ENUM_T MODIFY (DESCR_PLAIN VARCHAR2(4000))
/
ALTER TABLE KSEM_ENUM_T ADD (ENUM_TYPE VARCHAR2(255) NULL, ENUM_STATE VARCHAR2(255) NULL, DESCR_FORMATTED VARCHAR2(4000) NULL)
/

alter table KSEM_ENUM_VAL_T add x VARCHAR2(255)
/
update KSEM_ENUM_VAL_T set x = SORT_KEY;
alter table KSEM_ENUM_VAL_T drop column SORT_KEY;
alter table KSEM_ENUM_VAL_T rename column x to SORT_KEY;

/*ALTER TABLE KSEM_ENUM_VAL_T MODIFY (SORT_KEY VARCHAR2(255))
/
*/
CREATE TABLE KSEM_ENUM_ATTR
(
        ID VARCHAR2(255),
         OBJ_ID VARCHAR2(36),
         ATTR_KEY VARCHAR2(255),
         ATTR_VALUE VARCHAR2(4000),
         OWNER VARCHAR2(255),
        PRIMARY KEY (ID),
       CONSTRAINT KSEM_ENUM_ATTR_FK1
    FOREIGN KEY (OWNER )
    REFERENCES KSEM_ENUM_T (ENUM_KEY )
)
/
CREATE INDEX KSEM_ENUM_ATTR_IF1 on KSEM_ENUM_ATTR (OWNER ASC)
/