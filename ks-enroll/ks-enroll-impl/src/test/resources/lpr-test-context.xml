<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:ws="http://jax-ws.dev.java.net/spring/core"
  xmlns:wss="http://jax-ws.dev.java.net/spring/servlet" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context"
  xmlns:jee="http://www.springframework.org/schema/jee" xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
          http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
          http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
          http://jax-ws.dev.java.net/spring/core http://jax-ws.dev.java.net/spring/core.xsd
          http://jax-ws.dev.java.net/spring/servlet http://jax-ws.dev.java.net/spring/servlet.xsd
          http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
          http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd
          http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">

    <context:annotation-config />
    <import resource="classpath:META-INF/default-property-config-context-test.xml" />
    <import resource="classpath:ks-data-dictionary-services-configuration.xml" />
    <import resource="classpath:ks-data-dictionary-validator-configuration.xml" />
  <!-- Preloaded data -->
    <bean id="dataLoadListener" class="org.kuali.student.common.util.jpa.LoadSqlListener">
        <property name="jtaTxManager" ref="JtaTxManager" />
        <property name="shouldLoadData" value="true" />
        <property name="preloadMap">
            <map>
                <entry key="Acal">
                    <value>classpath:ks-lpr.sql</value>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="systemPropertyConfigurer" class="org.kuali.student.common.util.SystemPropertyConfigurer">
        <property name="properties" value="${propertiesPrefix.systemProperties}" />
    </bean>

    <bean id="AtomikosTxMgr" class="com.atomikos.icatch.jta.UserTransactionManager" init-method="init"
    destroy-method="close" depends-on="systemPropertyConfigurer" autowire-candidate="false" autowire="no">
        <property name="forceShutdown" value="true" />
        <property name="startupTransactionService" value="true" />
        <property name="transactionTimeout" value="60" />
    </bean>

    <bean id="AtomikosUsrTx" class="com.atomikos.icatch.jta.UserTransactionImp" depends-on="systemPropertyConfigurer"></bean>

    <bean id="JtaTxManager" class="org.springframework.transaction.jta.JtaTransactionManager" depends-on="systemPropertyConfigurer"
    autowire-candidate="false" autowire="no">
        <property name="transactionManager" ref="AtomikosTxMgr" />
        <property name="userTransaction" ref="AtomikosUsrTx" />
        <property name="transactionSynchronizationName" value="SYNCHRONIZATION_ON_ACTUAL_TRANSACTION" />
    </bean>

    <bean id="dataSource" class="org.kuali.student.common.test.spring.UniqueResourceAtomikosDataSourceBean"
    init-method="init" destroy-method="close" depends-on="systemPropertyConfigurer">
        <property name="uniqueResourceName" value="dataSource" />
        <property name="xaDataSourceClassName" value="${jdbc.xaDataSourceClassName}" />
        <property name="xaProperties" value="${propertiesPrefix.jdbc.xaDataSourceProperties}" />
        <property name="maxPoolSize" value="${jdbc.maxPoolSize}" />
    </bean>

    <bean id="vendorAdapter" class="${jpa.vendorAdapter}" depends-on="propertyConfigurer">
        <property name="databasePlatform" value="${jpa.databasePlatform}" />
        <property name="showSql" value="${jpa.showSql}" />
        <property name="generateDdl" value="${jpa.generateDdl}" />
    </bean>

  <!-- Default JPA EntityManagerFactory -->
    <bean id="defaultEntityManagerFactory" abstract="true"
    class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean" autowire-candidate="false" autowire="byType">
        <property name="jpaVendorAdapter" ref="vendorAdapter" />
        <property name="dataSource" ref="dataSource" />
        <property name="jpaPropertyMap" value="${propertiesPrefix.jpa.properties}" />
    <!--<property name="persistenceUnitPostProcessors" ref="postProcessorList" /> -->
    </bean>

    <bean id="entityManagerFactory" parent="defaultEntityManagerFactory" autowire-candidate="false" autowire="no">
        <property name="persistenceUnitName" value="Acal" />
        <property name="persistenceXmlLocation" value="classpath:META-INF/acal-persistence.xml" />
        <property name="dataSource" ref="dataSource" />
    </bean>

  <!--<bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean" autowire-candidate="false" 
    autowire="byType"> <property name="persistenceUnitName" value="Acal"/> <property name="persistenceXmlLocation" value="classpath:META-INF/persistence_jta.xml"/> 
    </bean> -->

    <bean id="entityManager" class="org.springframework.orm.jpa.support.SharedEntityManagerBean" autowire-candidate="false"
    autowire="no">
        <property name="entityManagerFactory" ref="entityManagerFactory" />
    </bean>

    <bean id="lprDao" class="org.kuali.student.enrollment.class1.lpr.dao.LprDao">
        <property name="em" ref="entityManager" />
    </bean>

    <tx:annotation-driven transaction-manager="JtaTxManager" order="1000" proxy-target-class="true" />

    <bean id="lprServiceValidationDecorator"
        class="org.kuali.student.enrollment.class1.lpr.service.decorators.LuiPersonRelationServiceValidationDecorator">
        <property name="validator" ref="validator"/>
        <property name="nextDecorator" ref="lprServiceImpl"/>
    </bean>
    
    <bean id="luiDao" class="org.kuali.student.enrollment.class1.lui.dao.LuiDao">
        <property name="em" ref="entityManager"/>
    </bean>   
    
    <bean id="luiLuiRelationDao" class="org.kuali.student.enrollment.class1.lui.dao.LuiLuiRelationDao">
        <property name="em" ref="entityManager"/>
    </bean>   

    <bean id="luiServiceImpl" class="org.kuali.student.enrollment.class1.lui.service.impl.LuiServiceImpl">
        <property name="luiDao" ref="luiDao"/>
        <property name="luiLuiRelationDao" ref="luiLuiRelationDao" />
    </bean>
    <bean id="lprServiceImpl" class="org.kuali.student.enrollment.class1.lpr.service.impl.LuiPersonRelationServiceImpl">
        <property name="lprDao" ref="lprDao" />
        <property name="lprRosterDao" ref="lprRosterDao" />
        <property name="lprTransDao" ref="lprTransDao" />
        <property name="lprTransItemDao" ref="lprTransItemDao"/>
        <property name="lprRosterEntryDao" ref="lprRosterEntryDao" />
    </bean>

    <bean id="stateService" class="org.kuali.student.r2.core.class1.state.service.impl.StateServiceImpl">
        <property name="stateDao" ref="stateDao" />
        <property name="lifecycleDao" ref="lifecycleDao" />
    </bean>
  
    <bean id="lprRosterDao" class="org.kuali.student.enrollment.class1.lpr.dao.LprRosterDao">
        <property name="em" ref="entityManager" />
    </bean>
  
    <bean id="lprTransDao" class="org.kuali.student.enrollment.class1.lpr.dao.LprTransactionDao">
        <property name="em" ref="entityManager" />
    </bean>
  
    <bean id="lprTransItemDao" class="org.kuali.student.enrollment.class1.lpr.dao.LprTransactionItemDao">
        <property name="em" ref="entityManager" />
    </bean>



    <bean id="lprRosterEntryDao" class="org.kuali.student.enrollment.class1.lpr.dao.LprRosterEntryDao">
        <property name="em" ref="entityManager" />
    </bean>

    <bean id="stateDao" class="org.kuali.student.r2.core.class1.state.dao.StateDao">
        <property name="em" ref="entityManager" />
    </bean>

    <bean id="lifecycleDao" class="org.kuali.student.r2.core.class1.state.dao.LifecycleDao">
        <property name="em" ref="entityManager" />
    </bean>

</beans>
